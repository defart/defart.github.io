<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
        Iframe Plugin Demo</title>
</head>
<body style="background-color: rgb(247, 174, 78)">
<h1> AyAyIframe Plugin Demo over UMD opsapi-iframe</h1>

<p id="name">  Hello, _______</p>
<hr>
<p id="token">AT</p>
<hr>
<button id="brew" >Random brewery</button>

<script src="/JUEMDE.js"></script>

<script type="application/javascript">
    const client = new opsapiIframe('http://localhost:3000');

    const onInit = (sdk) => {
        console.log(sdk);
        sdk.getUser().then(
                user => {
                    console.log('user', user);
                    document.querySelector('#name').innerText = 'Hello, ' + user.email;
                }
            );

            sdk.getAccessToken().then(
                at => {
                    console.log('user', at);
                    document.querySelector('#token').innerText = at.payload;
                }
            );
            
            document.querySelector('#brew').addEventListener('click', () => {
				const random = Math.ceil(Math.random() * 5000);
				sdk.call('https://api.openbrewerydb.org/breweries/' + random, null, {}, 'GET').then(
					msg => {
						const brew = msg.payload.data;
						alert(brew.name  + ' ' + brew.street + ',' + brew.city + ' ' + brew.state + '' + brew.country);
					}
				)
			});
    }

    client.init(onInit);
</script>
</body>
</html>
